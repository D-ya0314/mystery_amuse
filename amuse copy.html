<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ガラケー謎解き</title>
  <style>
    body {
      background: #000;
      color: #0f0;
      font-family: monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .phone {
      background: #222;
      border-radius: 20px;
      width: 300px;
      padding: 30px 20px;
      box-shadow: 0 0 20px #0f0;
    }
    .phone_screen {
      background: #000;
      border: 2px solid #0f0;
      padding: 15px;
      height: 160px;
      margin-bottom: 15px;
      font-size: 14px;
      white-space: pre-wrap;
    }
    .phone_input {
      margin-top: 10px;
      font-weight: bold;
      color: #0ff;
    }
    .phone_navpad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
      margin-bottom: 10px;
      justify-items: center;
    }
    .phone_keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .phone_btn {
      background: #111;
      border: 1px solid #0f0;
      color: #0f0;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      border-radius: 5px;
      min-width: 50px;
    }
    .phone_spacer {
      visibility: hidden;
    }
  </style>
</head>
<body>
  <div class="phone">
    <div class="phone_screen" id="screen">
      この謎を解けば、この世界が動き出す。
      2×1 6×1 8×2 7×4 3×2

      入力: <span class="phone_input" id="input">_ _ _ _ _</span>
    </div>

    <div class="phone_navpad">
      <div class="phone_btn" onclick="toggleInputMode()">変換</div>
      <div class="phone_btn" onclick="moveCursor('up')">▲</div>
      <div class="phone_spacer"></div>
      <div class="phone_btn" onclick="moveCursor('left')">◀</div>
      <div class="phone_btn" onclick="submitAnswer()">ENTER</div>
      <div class="phone_btn" onclick="moveCursor('right')">▶</div>
      <div class="phone_btn" onclick="deleteChar()">クリア</div>
      <div class="phone_btn" onclick="moveCursor('down')">▼</div>
      <div class="phone_btn" onclick="clearAll()">全消し</div>
    </div>

    <div class="phone_keypad" id="keypad">
      <div class="phone_btn" data-key="1">1あ</div>
      <div class="phone_btn" data-key="2">2か<br>abc</div>
      <div class="phone_btn" data-key="3">3さ<br>def</div>
      <div class="phone_btn" data-key="4">4た<br>ghi</div>
      <div class="phone_btn" data-key="5">5な<br>jkl</div>
      <div class="phone_btn" data-key="6">6は<br>mno</div>
      <div class="phone_btn" data-key="7">7ま<br>pqrs</div>
      <div class="phone_btn" data-key="8">8や<br>tuv</div>
      <div class="phone_btn" data-key="9">9ら<br>wxyz</div>
      <div class="phone_btn" data-key="a">＊<br>.-</div>
      <div class="phone_btn" data-key="0">0わ<br>!?</div>
      <div class="phone_btn" data-key="b">#<br>,_[]</div>
    </div>
  </div>

  <script>
    const keyMap = {
      alphabet: {
        2: ['a', 'b', 'c'],
        3: ['d', 'e', 'f'],
        4: ['g', 'h', 'i'],
        5: ['j', 'k', 'l'],
        6: ['m', 'n', 'o'],
        7: ['p', 'q', 'r', 's'],
        8: ['t', 'u', 'v'],
        9: ['w', 'x', 'y', 'z'],
        a: ['.', '-'],
        0: ['!', '?'],
        b: [',', '_', '[', ']']
      },
      number: {
        1: ['1'], 2: ['2'], 3: ['3'], 4: ['4'], 5: ['5'],
        6: ['6'], 7: ['7'], 8: ['8'], 9: ['9'], a: ['*'], 0: ['0'], b: ['#']
      },
      hiragana: {
        1: ['あ', 'い', 'う', 'え', 'お'],
        2: ['か', 'き', 'く', 'け', 'こ'],
        3: ['さ', 'し', 'す', 'せ', 'そ'],
        4: ['た', 'ち', 'つ', 'て', 'と'],
        5: ['な', 'に', 'ぬ', 'ね', 'の'],
        6: ['は', 'ひ', 'ふ', 'へ', 'ほ'],
        7: ['ま', 'み', 'む', 'め', 'も'],
        8: ['や', 'ゆ', 'よ'],
        9: ['ら', 'り', 'る', 'れ', 'ろ'],
        a: [''],
        0: ['わ', 'を', 'ん', 'ー'],
        b: ['']
      }
    };

    let puzzles = [
      { question: 'この謎を解けば、この世界が動き出す。\n2×1 6×1 8×2 7×4 3×2', answer: 'amuse' },
      { question: '①当時祭られていた動物は？\n②今から12時間後はひつじ、20時間後は？\n\n①②へ向かえ', answer: 'とりい' },
      { question: '鳥居に貼られた謎を解け\n\n答えは、◇のなか', answer: 'いのなか' },
      { question: '最終問題：abcの次は？', answer: 'd' }
    ];

    let currentPuzzle = 0;
    let inputMode = 'alphabet';
    let input = Array(5).fill('');
    let currentKey = null;
    let pressCount = 0;
    let pressTimeout;
    let cursor = 0;
    const inputEl = document.getElementById('input');
    const screenEl = document.getElementById('screen');

    function updateScreen() {
      screenEl.innerHTML = `${puzzles[currentPuzzle].question}\n\n入力: <span class="phone_input" id="input">${input.map((c, i) => i === cursor ? `[${c || '_'}]` : (c || '_')).join(' ')}</span>`;
      document.getElementById('input');
    }

    function updateInput() {
      const display = input.map((c, i) => i === cursor ? `[${c || '_'}]` : (c || '_')).join(' ');
      document.getElementById('input').textContent = display;
    }

    function handleKeyPress(key) {
      key = parseInt(key);
      if (!(key in keyMap[inputMode])) return;

      if (key !== currentKey) {
        confirmChar();
        currentKey = key;
        pressCount = 1;
      } else {
        pressCount++;
      }

      showTempChar(key);

      clearTimeout(pressTimeout);
      pressTimeout = setTimeout(() => {
        confirmChar();
      }, 500);
    }

    function showTempChar(key) {
      const chars = keyMap[inputMode][key];
      const char = chars[(pressCount - 1) % chars.length];
      input[cursor] = char;
      updateInput();
    }

    function confirmChar() {
      if (currentKey !== null) {
        const chars = keyMap[inputMode][currentKey];
        const char = chars[(pressCount - 1) % chars.length];
        input[cursor] = char;
        cursor = Math.min(cursor + 1, input.length - 1);
        updateInput();
      }
      currentKey = null;
      pressCount = 0;
    }

    function deleteChar() {
      input[cursor] = '';
      updateInput();
    }

    function clearAll() {
      input = Array(5).fill('');
      cursor = 0;
      updateInput();
    }

    function moveCursor(direction) {
      if (direction === 'left') cursor = Math.max(0, cursor - 1);
      else if (direction === 'right') cursor = Math.min(input.length - 1, cursor + 1);
      updateInput();
    }

    function toggleInputMode() {
      const modes = ['alphabet', 'number', 'hiragana'];
      const currentIndex = modes.indexOf(inputMode);
      inputMode = modes[(currentIndex + 1) % modes.length];
    }

    function submitAnswer() {
      confirmChar();
      const guess = input.join('');
      if (guess === puzzles[currentPuzzle].answer) {
        currentPuzzle++;
        if (currentPuzzle < puzzles.length) {
          input = Array(5).fill('');
          cursor = 0;
          updateScreen();
        } else {
          screenEl.innerHTML = '全ての謎を解いた！おめでとう！';
        }
      } else {
        alert('ピッ…違うようだ');
      }
    }

    document.querySelectorAll('.phone_btn[data-key]').forEach(btn => {
      btn.addEventListener('click', () => {
        handleKeyPress(btn.dataset.key);
      });
    });

    updateScreen();
  </script>
</body>
</html>
